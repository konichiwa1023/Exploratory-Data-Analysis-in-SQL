-- Code from previous step
DROP TABLE IF EXISTS recode;
CREATE TEMP TABLE recode AS
  SELECT DISTINCT category, 
         rtrim(split_part(category, '-', 1)) AS standardized
  FROM evanston311;

UPDATE recode SET standardized = 'Trash Cart' 
 WHERE standardized LIKE 'Trash%Cart';

UPDATE recode SET standardized = 'Snow Removal' 
 WHERE standardized LIKE 'Snow%Removal%';

UPDATE recode SET standardized = 'UNUSED' 
 WHERE standardized IN ('THIS REQUEST IS INACTIVE...Trash Cart', 
                        '(DO NOT USE) Water Bill',
                        'DO NOT USE Trash', 
                        'NO LONGER IN USE');

-- Select the recoded categories and the count of each
SELECT standardized, count(*)
FROM evanston311
LEFT JOIN recode
ON evanston311.category = recode.category
GROUP BY standardized
ORDER BY count DESC;
